<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DataTables – Button beside Show Entries</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- DataTables CSS & JS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <!-- Daterangepicker CSS & JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <div class="container mt-4">
    <h2 class="mb-4">DataTables – Delete Button Beside Show Entries</h2>

    <table id="example" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th><input type="checkbox" id="selectAll"></th>
          <th>Name</th>
          <th>Position</th>
          <th>Office</th>
          <th>Age</th>
          <th>Start date</th>
          <th>Salary</th>
        </tr>
        <tr>
          <th></th>
          <th><input type="text" placeholder="Search Name" class="form-control form-control-sm" /></th>
          <th><input type="text" placeholder="Search Position" class="form-control form-control-sm" /></th>
          <th><input type="text" placeholder="Search Office" class="form-control form-control-sm" /></th>
          <th><input type="text" placeholder="Search Age" class="form-control form-control-sm" /></th>
          <th><input type="text" placeholder="Search Start date" class="form-control form-control-sm" /></th>
          <th><input type="text" placeholder="Search Salary" class="form-control form-control-sm" /></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="checkbox" class="row-checkbox"></td>
          <td>Airi Satou</td>
          <td>Accountant</td>
          <td>Tokyo</td>
          <td>33</td>
          <td>2008-11-28</td>
          <td>$162,700</td>
        </tr>
        <tr>
          <td><input type="checkbox" class="row-checkbox"></td>
          <td>Angelica Ramos</td>
          <td>CEO</td>
          <td>London</td>
          <td>47</td>
          <td>2009-10-09</td>
          <td>$1,200,000</td>
        </tr>
        <tr>
          <td><input type="checkbox" class="row-checkbox"></td>
          <td>Ashton Cox</td>
          <td>Junior Technical Author</td>
          <td>San Francisco</td>
          <td>66</td>
          <td>2009-01-12</td>
          <td>$86,000</td>
        </tr>
        <!-- Tambah data lainnya -->
      </tbody>
    </table>
  </div>

  <script>
    $(document).ready(function () {

      var startDate = null;
      var endDate = null;

      // Custom date range filter
      $.fn.dataTable.ext.search.push(
        function (settings, data, dataIndex) {
          var date = data[5];
          if (!startDate || !endDate) return true;

          var d = moment(date, 'YYYY-MM-DD');
          if (d.isValid() && d.isBetween(startDate, endDate, undefined, '[]')) {
            return true;
          }
          return false;
        }
      );

      // Initialize DataTable
      var table = $('#example').DataTable({
        responsive: true,
        orderCellsTop: true,
        fixedHeader: true,
        order: [[1, 'asc']],
        columnDefs: [{ orderable: false, targets: 0 }],
        initComplete: function () {
          // Append delete button beside length control
          $("#example_length").append('<button id="bulkDelete" class="btn btn-danger btn-sm ms-3 d-none">Delete Selected (<span id="selectedCount">0</span>)</button>');
        }
      });

      // Per column search
      $('#example thead tr:eq(1) th').each(function (i) {
        $('input', this).on('keyup change', function () {
          if (table.column(i).search() !== this.value) {
            table
              .column(i)
              .search(this.value)
              .draw();
          }
        });
      });

      // Select/Deselect all checkboxes
      $('#selectAll').on('click', function () {
        var rows = table.rows({ 'search': 'applied' }).nodes();
        $('input[type="checkbox"].row-checkbox', rows).prop('checked', this.checked);
        updateSelectedCount();
      });

      // Update selected count and button visibility
      $('#example tbody').on('change', 'input[type="checkbox"].row-checkbox', function () {
        updateSelectedCount();
        if (!this.checked) {
          var el = $('#selectAll').get(0);
          if (el && el.checked && ('indeterminate' in el)) {
            el.indeterminate = true;
          }
        }
      });

      function updateSelectedCount() {
        var count = table.$('input[type="checkbox"].row-checkbox:checked').length;
        $('#selectedCount').text(count);
        if (count > 0) {
          $('#bulkDelete').removeClass('d-none');
        } else {
          $('#bulkDelete').addClass('d-none');
        }
      }

      // Bulk Delete action
      $(document).on('click', '#bulkDelete', function () {
        var selected = [];
        table.$('input[type="checkbox"].row-checkbox:checked').each(function () {
          selected.push($(this).closest('tr'));
        });

        if (selected.length === 0) {
          Swal.fire('No selection', 'Please select rows to delete.', 'info');
          return;
        }

        Swal.fire({
          title: 'Are you sure?',
          text: 'You are about to delete ' + selected.length + ' row(s). This action cannot be undone.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            selected.forEach(function (row) {
              table.row(row).remove().draw();
            });
            Swal.fire('Deleted!', 'Selected rows have been deleted.', 'success');
            updateSelectedCount();
          }
        });
      });

    });
  </script>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>